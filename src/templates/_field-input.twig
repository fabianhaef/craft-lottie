{% import "_includes/forms" as forms %}

<div class="lottie-field" data-field-id="{{ namespacedId }}">
    <!-- File Upload -->
    <div class="lottie-upload">
        {{ forms.fileField({
            label: "Lottie Animation File"|t('craft-lottie'),
            instructions: "Upload a .json Lottie animation file."|t('craft-lottie'),
            id: id ~ '-file',
            name: name ~ '[file]',
            accept: '.json'
        }) }}
    </div>

    <!-- Animation Preview -->
    <div class="lottie-preview-container" style="display: none;">
        <h4>{{ "Animation Preview"|t('craft-lottie') }}</h4>
        <div id="{{ namespacedId }}-preview" class="lottie-preview" style="width: 400px; height: 300px; border: 1px solid #ddd; background: #f9f9f9;"></div>
    </div>

    <!-- Editor Controls -->
    <div class="lottie-controls" style="display: none;">
        <div class="field">
            <h4>{{ "Animation Controls"|t('craft-lottie') }}</h4>
            
            <!-- Color Editor -->
            {% if field.enableColorEditing ?? true %}
            <div class="lottie-color-editor">
                <label>{{ "Colors"|t('craft-lottie') }}</label>
                <div id="{{ namespacedId }}-colors" class="lottie-color-picker-container">
                    <!-- Color pickers will be dynamically added here -->
                </div>
            </div>
            {% endif %}

            <!-- Speed Control -->
            {% if field.enableSpeedControl ?? true %}
            <div class="lottie-speed-control">
                {{ forms.textField({
                    label: "Animation Speed"|t('craft-lottie'),
                    instructions: "Playback speed multiplier (1.0 = normal speed)"|t('craft-lottie'),
                    id: id ~ '-speed',
                    name: name ~ '[speed]',
                    value: value.speed ?? 1.0,
                    type: 'number',
                    min: 0.1,
                    max: 5.0,
                    step: 0.1
                }) }}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Hidden field for the final JSON data -->
    {{ forms.hiddenField({
        id: id,
        name: name ~ '[data]',
        value: value.data is defined ? value.data|json_encode : ''
    }) }}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    window.LottieFieldEditor = window.LottieFieldEditor || {};
    window.LottieFieldEditor['{{ namespacedId }}'] = new LottieEditor('{{ namespacedId }}', {
        enableColorEditing: {{ field.enableColorEditing ?? true ? 'true' : 'false' }},
        enableSpeedControl: {{ field.enableSpeedControl ?? true ? 'true' : 'false' }}
    });
});
</script>